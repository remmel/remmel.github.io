<!doctype html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="http://docs.handsontable.com/0.32.0/bower_components/handsontable/dist/handsontable.full.css">
    <script src="http://docs.handsontable.com/0.32.0/bower_components/handsontable/dist/handsontable.full.js"></script>
</head>
<body>
<div id="hot"></div>
<h2>Array</h2>
<button id="toJson">To Json array</button>
<button id="toPHPArrayShort">To PHP short array "[]"</button>
<button id="toPHPArray">To PHP array "array()"</button>

<h2>Associative array : 1st column is key</h2>
<button id="toJsonAssoc">To Json associative array</button>
<button id="toPhpAssociativeArrayShort">To PHP short associative array "[]"</button>
<button id="toPhpAssociativeArray">To PHP associative array "array()"</button>

<h2>Associative array : 1st row is field name</h2>
<button id="toJsonAssocField">To Json associative array</button>
<button id="toPhpAssociativeArrayShortField">To PHP short associative array "[]"</button>
<button id="toPhpAssociativeArrayField">To PHP associative array "array()"</button>
<br /><br />
<textarea id="output"></textarea>

<style>
    #output{
        width: 100%;
        height: 300px;
    }
</style>
<script>

    Array.prototype.clean = function() {
        for (var i = 0; i < this.length; i++) {
            var subarray = this[i];
            for (var j = 0; j < subarray.length; j++) {
                if (subarray[j] == null) {
                    subarray.splice(j, 1);
                    j--;
                }
            }

            //remove empty subarray
            if(subarray.length == 0) {
                this.splice(i,1);
                i--;
            }
        }
        return this;
    };

    Array.prototype.toAssoc = function() {
        var assoc = {};
        var me = this;
        this.forEach(function(val, i) {
            assoc[me[i][0]] = me[i][1];
        });
        return assoc;
    };

    Array.prototype.toAssocField = function() {
        var rows = [];
        var me = this;
        this.forEach(function(val, i) {
            if(i!=0) { //skip header
                var row = {};
                me[i].forEach(function(val2, j) {
                    row[me[0][j]] = me[i][j];
                });
                rows.push(row);
            }
        });
        return rows;
    };

    Object.prototype.toPHPArrayShort = Array.prototype.toPHPArrayShort = function() {
        return JSON.stringify(this)
                .replaceAll('{', '[').replaceAll('}', ']')
                .replaceAll(':', '=>');
    };

    Object.prototype.toPHPArray = Array.prototype.toPHPArray = function() {
        return JSON.stringify(this)
                .replaceAll('{', 'array(').replaceAll('}', ')')
                .replaceAll('[', 'array(')
                .replaceAll(']', ')')
                .replaceAll(':', '=>');
    };

    String.prototype.replaceAll = function(search, replacement) {
        return this.split(search).join(replacement);
//        return this.replace(new RegExp(search, 'g'), replacement); //must handle special char : eg [ => \\[
    };

    $$ = function(id) {
        return document.getElementById(id);
    };

    var output = $$('output');

    var hot = new Handsontable($$('hot'), {
//        data: [['a', 1],['b', 2]],
        data: [["name","age"],["John","65"],["Bob","54"]],
        minSpareCols: 1,
        minSpareRows: 1,
        rowHeaders: true,
        colHeaders: true,
        contextMenu: true
    });

    //array
    $$('toJson').onclick = function() {
        var data = hot.getData().clean();
        output.value = JSON.stringify(data);
    };

    $$('toPHPArrayShort').onclick = function() {
        var data = hot.getData().clean();
        output.value = data.toPHPArrayShort();
    };

    $$('toPHPArray').onclick = function() {
        var data = hot.getData().clean();
        output.value = data.toPHPArray();
    };

    //assoc
    $$('toJsonAssoc').onclick = function() {
        var data = hot.getData().clean().toAssoc();
        output.value = JSON.stringify(data);
    };

    $$('toPhpAssociativeArrayShort').onclick = function() {
        data = hot.getData().clean().toAssoc();
        output.value = data.toPHPArrayShort();
    };

    $$('toPhpAssociativeArray').onclick = function() {
        var data = hot.getData().clean().toAssoc();
        output.value = data.toPHPArray();
    };

    //assoc field
    $$('toJsonAssocField').onclick = function() {
        var data = hot.getData().clean().toAssocField();
        output.value = JSON.stringify(data);
    };

    $$('toPhpAssociativeArrayShortField').onclick = function() {
        data = hot.getData().clean().toAssocField();
        output.value = data.toPHPArrayShort();
    };

    $$('toPhpAssociativeArrayField').onclick = function() {
        var data = hot.getData().clean().toAssocField();
        output.value = data.toPHPArray();
    };
</script>
</body>
</html>